<h1>Order #<%= @order.id %></h1>

<% unless @order.shipped? %>
  <nav id="page-actions">
    <%= link_to 'Cancel Order', "/orders/#{@order.id}?status=3", method: :patch %>
  </nav>
<% end %>

<h3>Status: <%= @order.status %> </h3>
<h3>Total Items: <%= @order.total_quantity %> </h3>

<section class = "shipping-address">
  <h2>Shipping Info</h1>
  <table>
    <tr>
      <th>Name</th>
      <th>Address</th>
      <th>City</th>
      <th>State</th>
      <th>Zip</th>
    </tr>
    <tr>
      <td><p><%= @order.name %> </p></td>
      <td><p><%= @order.address %> </p></td>
      <td><p><%= @order.city %> </p></td>
      <td><p><%= @order.state %> </p></td>
      <td><p><%= @order.zip %> </p></td>
    </tr>
  </table>
</section>

<h2>Order Info</h2>
  <table>
    <tr>
      <th>Item</th>
      <th>Sold By</th>
      <th>Image</th>
      <th>Description</th>
      <th>Price</th>
      <th>Quantity</th>
      <th>Subtotal</th>
      <th>status</th>
    </tr>
  <% @order.item_orders.each do |item_order|%>
    <tr id="item-<%=item_order.item_id%>">
      <td><%=link_to item_order.item.name, "/items/#{item_order.item_id}"%></td>
      <td><%= link_to item_order.item.merchant.name, "/merchants/#{item_order.item.merchant.id}"%></td>
      <td><%= image_tag item_order.item.image %></td>
      <td><%= item_order.item.description %></td>
      <td><%= number_to_currency(item_order.price)%></td>
      <td><%= item_order.item.quantity_ordered%></td>
      <td><%= number_to_currency(item_order.subtotal)%></td>
    </tr>
  <% end %>
</table>

<section id="grandtotal">
  <p id="<%= 'discounted-total' if @order.coupon %>">
    <%= 'Discounted ' if @order.coupon %>Total: <%= number_to_currency(@order.grandtotal) %>
  </p>
</section>
<% if @order.coupon %>
  <p>
    Applied Coupon: <%= @order.coupon.name %>, Code: <%= @order.coupon.code %><br />
    Discount: <%= @order.coupon.percent_off %>% off items from <%= @order.coupon.merchant.name %>
  </p>
<% end %>

<section id="datecreated">
  <p><%= @order.created_at %></p>
</section>
<section id="dateupdated">
  <p><%= @order.updated_at %></p>
</section>
